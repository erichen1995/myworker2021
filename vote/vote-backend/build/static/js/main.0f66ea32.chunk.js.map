{"version":3,"sources":["Login.js","Register.js","Home.js","CreateVote.js","hooks.js","data-fetcher.js","ViewVote.js","Myvote.js","App.js","store.js","index.js"],"names":["Login","history","usernameRef","useRef","passwordRef","dispatch","useDispatch","a","axios","post","name","current","props","value","password","then","res","type","user","data","push","catch","e","alert","toString","initialValues","remember","requiredMark","className","Item","label","rules","required","message","ref","autoComplete","Password","htmlType","onClick","Register","nameRef","emailRef","genderM","genderF","useState","previewUrl","setPreviewUrl","state","gender","checked","email","avatar","fd","FormData","set","target","files","url","onChange","src","style","width","height","border","Content","Layout","Header","Footer","Home","useHistory","useSelector","tried","triedLogin","useEffect","to","CreateVote","query","URLSearchParams","useLocation","search","voteInfo","multiSelect","has","vote","console","log","id","onFinish","layout","placeholder","fontSize","fontWeight","bordered","List","initialValue","fields","add","remove","errors","map","field","index","length","MinusCircleFilled","color","validateTrigger","noStyle","fontsize","key","icon","PlusCircleFilled","textAlign","margin","moment","format","showTime","inputReadOnly","allowClear","valuePropName","voteCache","Object","create","voteFetcher","get","getVote","val","ViewVote","match","useRouteMatch","params","options","optionsInfo","setOptionsInfo","userInfo","antIcon","LoadingOutlined","spin","selected","deadline","Date","toISOString","socket","io","emit","on","info","disconnect","allUsers","useMemo","users","reduce","ary","option","Users","uniqBy","title","desc","idx","some","voteOption","content","CheckOutlined","indicator","toFixed","percent","strokeLinecap","showInfo","trailColor","strokeColor","strokeWidth","anonymous","display","borderRadius","verticalAlign","slice","concat","My","rows","count","voteData","setVoteData","votes","setVotes","counts","setCounts","rowRenderer","countV","UserVoteId","Set","voteId","UserId","size","countVoter","isRowLoaded","loadMoreRows","startIndex","stopIndex","splice","rowCount","onRowsRendered","registerChild","window","outerWidth","outerHeight","rowHeight","App","path","exact","component","fallback","alt","getUserInfo","login","logout","rootSaga","saga","createSagaMiddleware","initialState","store","createStore","action","applyMiddleware","put","takeEvery","run","locale","document","documentElement","innerWidth","onresize","ReactDOM","render","StrictMode","zhCN","getElementById"],"mappings":"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","file":"static/js/main.0f66ea32.chunk.js","sourcesContent":["import {useState,useEffect,useRef, useContext} from \"react\"\r\nimport axios from \"axios\"             //axios \r\n// import UserContext from \"./UserContext\"\r\nimport { useDispatch } from \"react-redux\"\r\n\r\n\r\n// import { Input, Layout } from 'antd';\r\n// import { EyeInvisibleOutlined, EyeTwoTone,  UserOutlined } from '@ant-design/icons';\r\n// import { Button } from 'antd';\r\n\r\nimport \"./Login.css\"\r\nimport { Form, Input, Button, Checkbox } from 'antd';\r\n\r\n\r\n\r\n\r\n\r\n\r\nfunction Login({history}){                   //bug {{history}}\r\n\r\n\r\n\r\n\r\n\r\n  var usernameRef = useRef()\r\n  var passwordRef = useRef()\r\n  // var userCtx = useContext(UserContext)\r\n  var dispatch = useDispatch()\r\n\r\n  // async function login(){\r\n  //   try{\r\n  //     // var userInfo = (await axios.post('/account/login',{\r\n  //     //   name:usernameRef.current.value,\r\n  //     //   password:PasswordRef.current.value,\r\n  //     // })).data\r\n  //     await dispatch({\r\n  //       type:\"login\",                                 //匹配的是user-info\r\n  //       name:usernameRef.current.value,\r\n  //       password:PasswordRef.current.value,\r\n  //     })\r\n  //   // userCtx.setUserInfo(userInfo)   \r\n  //     history.go(-1)\r\n  //   }catch(e){\r\n  //     alert(e.toString())\r\n  //   }\r\n  //   //history push 的是path\r\n  // }\r\n\r\n\r\n  async function login() {\r\n    axios.post('/account/login', {\r\n      \r\n      name: usernameRef.current.props.value,\r\n      password: passwordRef.current.props.value,\r\n    }).then(res => {\r\n      dispatch({                                  //dispatch 会立即执行 \r\n        type: 'user-info',\r\n        user: res.data\r\n      })\r\n      history.push(\"/home\")\r\n    }).catch(e => {\r\n      alert(e.toString())\r\n    })\r\n\r\n  }\r\n\r\n  return (\r\n    \r\n      <Form\r\n        name=\"basic\"\r\n        initialValues={{ remember: true }}\r\n        requiredMark={false}  \r\n        className=\"loginPage\"\r\n      >\r\n        <Form.Item\r\n          label=\"用户\"\r\n          name=\"username\"\r\n          rules={[{ required: true, message: '请输入用户!' }]}\r\n        >\r\n          <Input ref ={usernameRef} autoComplete=\"off\"/>\r\n        </Form.Item>\r\n        <Form.Item\r\n          label=\"密码\"\r\n          name=\"password\"\r\n          rules={[{ required: true, message: '请输入密码!' }]}\r\n        >\r\n          <Input.Password   ref ={passwordRef} />\r\n        </Form.Item>\r\n        <Form.Item >\r\n          <Button className=\"LogBut\" type=\"primary\" htmlType=\"submit\" onClick={login}>\r\n            登录\r\n          </Button>\r\n        </Form.Item>\r\n      </Form>\r\n  )\r\n}\r\nexport default Login \r\n\r\n        {/* <Content>\r\n        <div>\r\n          用户名: \r\n          <Input\r\n            placeholder=\"输入姓名\"\r\n            ref ={usernameRef}\r\n            prefix={<UserOutlined className=\"site-form-item-icon\" />}\r\n          /> \r\n        </div>\r\n        <div>\r\n        密码:  <Input.Password ref={passwordRef}\r\n          placeholder=\"输入密码\"\r\n          iconRender={visible => (visible ? <EyeTwoTone /> : <EyeInvisibleOutlined />)}   />\r\n        </div>\r\n        </Content>\r\n        <Content>\r\n        <Button type=\"primary\" onClick={login} style={{display:\"block\",textAlign:\"center\",width:200,marginLeft:\"auto\",marginRight:\"auto\"}}> 登录</Button>\r\n        </Content> */}\r\n        {/* <div>\r\n          用户名: \r\n          <input ref ={usernameRef}/> \r\n          密码: \r\n          <input ref ={passwordRef}/> \r\n          <Button type=\"primary\" onClick={login} style={{display:\"block\",textAlign:\"center\",width:200,marginLeft:\"auto\",marginRight:\"auto\"}}> 登录</Button>\r\n        </div> */}\r\n","import axios from \"axios\"\r\nimport { useRef, useState } from \"react\"\r\n\r\nimport { useInput } from \"./hooks\"\r\nimport \"./Register.css\"\r\nimport { Input } from 'antd';\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nfunction Register({history}){\r\n  var nameRef = useRef()\r\n  var passwordRef = useRef()\r\n  var emailRef = useRef()\r\n  var genderM = useRef(\"\")\r\n  var genderF = useRef(\"\")\r\n  \r\n  var [previewUrl,setPreviewUrl] = useState(null)\r\n  \r\n    // const [fileList, setFileList] = useState([]);\r\n   \r\n    // const onChange = ({ fileList: newFileList }) => {\r\n    //   setFileList(newFileList);\r\n    // };\r\n  \r\n    // const onPreview = async file => {\r\n    //   let src = file.url;\r\n    //   if (!src) {\r\n    //     src = await new Promise(resolve => {\r\n    //       const reader = new FileReader();\r\n    //       reader.readAsDataURL(file.originFileObj);\r\n    //       reader.onload = () => resolve(reader.result);\r\n    //     });\r\n    //   }\r\n    //   const image = new Image();\r\n    //   image.src = src;\r\n    //   const imgWindow = window.open(src);\r\n    //   imgWindow.document.write(image.outerHTML);\r\n      \r\n    // };\r\n\r\n  async function  register(){\r\n    await axios.post('/account/register',{\r\n      name:nameRef.current.state.value,\r\n      password:passwordRef.current.state.value,\r\n      gender:genderM.current.checked?genderM.current.value:genderF.current.value,\r\n      email:emailRef.current.state.value,\r\n      avatar:previewUrl,                      //bug 没axios avatar 直接就不会达到后端 \r\n    })\r\n    alert('ok')\r\n    history.push(\"/Login\")\r\n  }\r\n  \r\n\r\n  async function upload(e){\r\n    var fd = new FormData()\r\n    fd.set('file',e.target.files[0])       \r\n    var res = await axios.post('/upload',fd)               // bug 不等待会失败并且服务器报错\r\n    setPreviewUrl(res.data.url)                            \r\n  }\r\n\r\n  return (\r\n    <div className=\"registerWrap\" >\r\n        <div className=\"nameInput\"><span>用户名:</span><Input type=\"text\" ref ={nameRef}/></div>\r\n        <div><span>性别:  </span><input type=\"radio\"  name=\"a1\" ref={genderM} value=\"m\"/><span>男</span>\r\n                  <input type=\"radio\"  name=\"a1\" ref={genderF} value=\"f\"/><span>女</span>\r\n        </div>\r\n        <div><span>密码: </span><Input type=\"password\" ref ={passwordRef}/></div>\r\n        <div><span>邮箱：</span><Input type=\"email\" ref ={emailRef}/></div>                   \r\n        <div><span>头像：</span><Input type=\"file\" onChange={upload}/></div>\r\n        <div><img src={previewUrl} style={{width:100,height:100,border:0 }} /> </div> \r\n        {/* <ImgCrop rotate>\r\n          <Upload\r\n            action='https://www.mocky.io/v2/5cc8019d300000980a055e76'\r\n          \r\n            listType=\"picture-card\"\r\n            fileList={fileList}\r\n            onChange={onChange}\r\n            onPreview={onPreview}\r\n          >\r\n            {fileList.length < 1 && '+ Upload'}\r\n          </Upload>\r\n        </ImgCrop>                       */}\r\n        <button onClick={register}>注册</button>  \r\n    </div>\r\n  )\r\n}\r\nexport default Register\r\n","\r\nimport { useEffect } from \"react\"\r\nimport { useDispatch, useSelector } from \"react-redux\"\r\nimport {Link, useHistory} from \"react-router-dom\"\r\n// import AUserContext from \"./UserContext\"\r\n\r\nimport './Home.css';\r\n\r\n//antd\r\nimport { Layout, Button } from 'antd';\r\nconst { Header, Content, Footer } = Layout;\r\n\r\n\r\nexport default function Home(){\r\n  \r\n  // var userCtx = useContext(AUserContext)\r\n  \r\n  var history = useHistory()\r\n  var user = useSelector(state=>state.user)\r\n  var tried = useSelector(state => state.triedLogin)\r\n  var dispatch = useDispatch()\r\n\r\n  useEffect(()=>{\r\n    (async () => {\r\n      if (user) {\r\n        return\r\n      }\r\n      if (tried) {\r\n        history.push('/login')\r\n      }\r\n      if (!user) {\r\n        dispatch({type: 'get-user-info'})\r\n      }\r\n    })()\r\n  },[user,tried])\r\n\r\n  return (\r\n    \r\n    <div >\r\n      <Content  className=\"signalSelect\">\r\n      <div><Link to=\"/create\"> <img src=\"./icons/signal.png\"/><br/> <Button>单选投票</Button></Link></div>\r\n      </Content>\r\n      <Content className=\"miltSelect\">\r\n      <div><Link to=\"/create?multiSelect\">  <img src=\"./icons/mult.png\"/><br/><Button>多选投票</Button></Link></div>\r\n      </Content>\r\n    </div>\r\n  )\r\n}\r\n","import { useState } from \"react\"\r\n// import {produce} from 'immer'\r\nimport { useQuery } from \"./hooks\"\r\nimport axios from \"axios\"\r\nimport {Link} from \"react-router-dom\"\r\n\r\n//antd\r\nimport { Form, Input, Button, Switch, DatePicker } from 'antd';\r\nimport moment from 'moment';\r\nimport { PlusCircleFilled, MinusCircleFilled } from '@ant-design/icons';\r\n\r\nimport \"./CreateVote.css\"\r\n\r\n\r\n\r\n\r\n\r\nexport default function CreateVote({ history }) {\r\n\r\n  // var [optionStrs, setOptions] = useState(['', ''])\r\n\r\n  var query = useQuery()\r\n  // console.log(query)\r\n  //发生了非受控组件,因为需要输入值 \r\n\r\n\r\n  // function addOption(){\r\n  //   setOptions([...optionStrs,\"\"])\r\n  // }\r\n\r\n\r\n  // function deleteOption(idx){\r\n  //   setOptions(optionStrs.filter((it,index)=>\r\n  //     index !== idx                                 //bug 在删除点第几个得时候会发生删除虚拟dom位置得值\r\n  //   ))\r\n  // }\r\n  // function setOptionStr(e,idx){                     //bug 不可变数据\r\n  //   setOptions (produce(draft=>{\r\n  //     draft[idx] = e.target.value\r\n  //   }))\r\n  // }\r\n\r\n\r\n\r\n  async function createVote(voteInfo) {\r\n    try {\r\n      var vote = (await axios.post('/vote/create', {\r\n        ...voteInfo,\r\n        multiSelect: query.has(\"multiSelect\"),\r\n      })).data\r\n      console.log(voteInfo)\r\n      history.push('/vote/' + vote.id)\r\n    } catch (e) {\r\n      alert(e.toString())\r\n    }\r\n  }//如果不需要读内部作用域得东西 可以放函数外面  await 会把数据转换为对象\r\n\r\n  return (\r\n    \r\n    <Form\r\n      name=\"basic\"\r\n      initialValues={{}}\r\n      requiredMark=\"\"\r\n      onFinish={createVote}\r\n      className=\"Create\"\r\n      layout=\"vertical\"\r\n\r\n    >\r\n      <Link  to={\"/Home\"} ><div>返回</div></Link>\r\n      <Form.Item\r\n        name=\"title\"\r\n        rules={[{ required: true, message: '请输入投票标题' }]}\r\n      >\r\n        <Input className=\"titleInput\" placeholder=\"投票标题\" style={{ fontSize: 25, fontWeight: \"bolder\" }} bordered={false} autoComplete=\"off\" />\r\n      </Form.Item>\r\n\r\n      <Form.Item\r\n        name=\"desc\"\r\n        rules={[{ required: false, message: '请输入投票描述' }]}\r\n      >\r\n        <Input className=\"descInput\" placeholder=\"补充描述(选填)\" style={{ fontSize: 20, fontWeight: \"bold\" }} bordered={false} autoComplete=\"off\" />\r\n      </Form.Item>\r\n      <Form.List\r\n        name=\"options\"\r\n        initialValue={[\"\", \"\"]}\r\n      >\r\n        {(fields, { add, remove }, { errors }) => (\r\n          <>\r\n            {fields.map((field, index) => (\r\n\r\n              <Form.Item\r\n                // {...(index === 9999 ? formItemLayout : formItemLayoutWithOutLabel)}\r\n                // label={index === 0 ? '' : ''}\r\n                required={false}\r\n                key={field.key}\r\n              >\r\n                {fields.length > 1 ? (\r\n                  <MinusCircleFilled\r\n                    className=\"dynamic-delete-button\"\r\n                    style={{ color: \"red\" }}\r\n                    onClick={() => remove(field.name)}\r\n                  />\r\n                ) : null}\r\n                <Form.Item\r\n                  {...field}\r\n                  validateTrigger={['onChange', 'onBlur']}\r\n                  noStyle\r\n                >\r\n                  <Input className=\"optionInput\" placeholder=\"选项\" style={{ width: '80%', fontsize: 18, fontWeight: \"bold\" }} bordered={false} autoComplete=\"off\" />\r\n                </Form.Item>\r\n\r\n              </Form.Item>\r\n            ))}\r\n            <Form.Item className=\"addWrap\" >\r\n              <Button\r\n                type=\"link\"\r\n                onClick={() => add()}\r\n                icon={<PlusCircleFilled />}\r\n                className=\"addBut\"\r\n                style={{ width: '80%', textAlign: \"left\", margin: 0 }}\r\n\r\n              >\r\n                <span className=\"addText\">添加选项</span>\r\n              </Button>\r\n\r\n            </Form.Item>\r\n          </>\r\n        )}\r\n      </Form.List>\r\n\r\n      <Form.Item name=\"deadline\" className=\"deadlineInput\" label=\" 截止时间\" initialValue={moment().add(1, \"days\")}  >\r\n        <DatePicker format=\"YYYY-MM-DD HH:mm\" showTime={{ format: \"HH:mm\" }} inputReadOnly={true} bordered={false} allowClear={false} />\r\n      </Form.Item>\r\n\r\n      <Form.Item name=\"anonymous\" className=\"anonymousInput\" label=\" 匿名投票\" valuePropName=\"checked\" value=\"horizontal\"  ><Switch /></Form.Item>\r\n      <Form.Item name=\"restricted\" className=\"restrictedInput\" label=\"限制传播\" valuePropName=\"checked\" value=\"horizontal\" >\r\n        <Switch />\r\n      </Form.Item>\r\n      <Form.Item>\r\n        <Button className=\"subBut\" type=\"primary\" htmlType=\"submit\" style={{ width: '100%', height: \"0.4rem\" }}  >\r\n          完成\r\n        </Button>\r\n      </Form.Item>\r\n    </Form>\r\n  );\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n  // return (\r\n\r\n\r\n  //   <div>\r\n\r\n  //     <div>标题:<input type=\"text\" {...title}/></div>\r\n  //     <div>描述:<input type=\"text\" {...desc}/></div>\r\n  //     选项:\r\n  //       {optionStrs.map((optionStr,idx) =>{         //bug input是非受控组件 \r\n  //         return <div key = {idx}>\r\n  //         <button onClick={()=>deleteOption(idx)}>-</button >    \r\n  //         <input type=\"text\" value={optionStr} onChange={e=>setOptionStr(e,idx)}/>\r\n  //         </div>\r\n  //       })}    \r\n  //       <div><button onClick={addOption}>添加选项</button> </div>  \r\n  //     <div>结束时间:\r\n  //       <input type=\"datetime-local\" {...deadline}/>\r\n  //     </div>  \r\n  //     <div>匿名投票:<input type=\"checkbox\" {...anonymous}/></div>\r\n  //     <div>限制传播:<input type=\"checkbox\"{...restricted}/></div>\r\n  //     <button onClick={createVote}>创建</button>\r\n\r\n  //   </div>\r\n  // )// 使用不可变数据来使得数据可以传递    \r\n}\r\n","import axios from 'axios'\r\nimport {useState,useCallback, useEffect}from 'react'\r\nimport { useLocation } from 'react-router'\r\n\r\nexport function useInput(init){\r\n  var [value,setValue] = useState(init)        //可用于input\r\n  var [checked,setChecked] = useState(init)   //可以用于checkbox\r\n  var onChange = useCallback(function (e){\r\n    setChecked(e.target.checked)              //都拥有checked属性 所以都设置\r\n    setValue(e.target.value)\r\n  },[])\r\n  return {value,checked,onChange}\r\n}\r\n\r\nexport function useQuery(){\r\n  return new URLSearchParams(useLocation().search)  //文档中为自取？后内容做的hook\r\n}\r\n\r\nexport function useRequest(url){\r\n  var [data,setData] = useState()\r\n  var [loading,setLoading] = useState(true)\r\n  useEffect(()=>{\r\n    axios.get(url).then((res)=>{\r\n      setData(res)\r\n      setLoading(false)\r\n    })\r\n  },[url])\r\n  return [data,loading]\r\n}\r\n\r\nexport function useForceUpdate(){\r\n  var [a,setA]=useState(0)\r\n  let forceUpdate=useCallback(()=>{\r\n    setA(Math.random())\r\n  },[])\r\n  return forceUpdate\r\n}\r\n","import axios from \"axios\"\r\n\r\n\r\nconst voteCache = Object.create(null)\r\n\r\nfunction getVote(id){\r\n  return axios.get('/vote/get/'+id)\r\n}\r\n\r\n\r\nexport const voteFetcher ={\r\n  read(id){\r\n    if(id in voteCache){\r\n      return voteCache[id]                      //bug 出现别人的页面直接全部刷新所有选项\r\n    }else{\r\n      throw getVote(id).then(val=>{               \r\n        voteCache[id]= val.data\r\n      })\r\n    }\r\n    \r\n  }\r\n}\r\n","\r\nimport { useHistory, useRouteMatch } from \"react-router\"\r\nimport axios from \"axios\"\r\nimport {  useEffect, useState,useMemo, useCallback} from \"react\"          //memo 是react 里的\r\nimport io from \"socket.io-client\"\r\n// import {useUserInfo} from \"./UserContext\"                      \r\n// import {useRequest} from \"./hooks\"\r\nimport {voteFetcher} from \"./data-fetcher\"\r\nimport uniqBy from \"lodash/uniqBy\"\r\n\r\nimport { useSelector } from \"react-redux\"\r\nimport \"./ViewVote.css\"\r\nimport { Progress } from 'antd';\r\n\r\nimport { Spin } from 'antd';\r\n\r\nimport { LoadingOutlined,CheckOutlined  } from '@ant-design/icons';\r\n\r\nexport default function ViewVote(){\r\n    \r\n    var history = useHistory()\r\n    var match = useRouteMatch()\r\n    // var [data,loading]= useRequest('/vote/' + match.params.id)          //社区办法  \r\n    // var vote = data.vote                                                //data 有时候会请求不到\r\n    var {vote,options} = voteFetcher.read(match.params.id)\r\n    var [optionsInfo,setOptionsInfo] = useState(options)     //bug 把options放入了【】 导致下层无法获取\r\n    \r\n    \r\n    \r\n    useEffect(()=>{\r\n      setOptionsInfo(options)   //bug  出现投票改变而投票数据不变需要监控option 数据\r\n    },[options])                 //bug 自己修改成optionsId 发生点击不修改\r\n    \r\n    const userInfo = useSelector(state=> state.user) \r\n    \r\n    const antIcon = <LoadingOutlined style={{ fontSize: 20 }} spin />;\r\n\r\n\r\n    // var userInfo = useUserInfo()                              //导出了登录的用户\r\n    //向某选项投票   \r\n    \r\n    \r\n\r\n    async function voteOption(id,selected){                  //selected 表示当前用户是否选中\r\n      if(!userInfo){\r\n        history.push(\"/login\")\r\n        return\r\n      }\r\n      if(!selected){\r\n        await axios.post('/vote/voteup/' + id)\r\n\r\n        console.log('ok') \r\n      }else{\r\n        await axios.post('/vote/cancel/' + id)\r\n\r\n        console.log(\"cancel ok\")\r\n        \r\n      }\r\n      \r\n    }\r\n    useEffect(()=>{\r\n      //如果没过期\r\n      if(vote.deadline > new Date().toISOString()){\r\n        var socket = io(\r\n          // {transports:[\"websocket\",\"polling\"]}\r\n        )                                   //连接io server \r\n        socket.emit('select root',vote.id)\r\n        //收到了本问题下的投票信息\r\n        socket.on('voting info',info => {\r\n          setOptionsInfo(info)\r\n        })\r\n        \r\n        return ()=>socket.disconnect()  //bug 在改变vote/1时候会发生下方数据不变\r\n        \r\n      }\r\n\r\n    },[vote.id])\r\n    \r\n\r\n    \r\n      \r\n    \r\n\r\n\r\n    // var allUsers = useMemo(() =>{\r\n    //   var users= optionsInfo.reduce((ary,option)=>{               //不好一直算,使用useMemo\r\n    //     ary.push(...option.Users)\r\n    //     return ary\r\n    //   },[])\r\n    //   var uniqueUsers = uniqBy(users,'id')\r\n      \r\n    //   return uniqueUsers\r\n    // },[optionsInfo])   \r\n    \r\n      var allUsers = useMemo(() =>{\r\n        var users= optionsInfo.reduce((ary,option)=>{               //不好一直算,使用useMemo\r\n          ary.push(...option.Users)\r\n          return ary\r\n        },[])\r\n        var uniqueUsers = uniqBy(users,'id')\r\n        \r\n        return uniqueUsers\r\n      },[optionsInfo])   \r\n    \r\n    return (\r\n      <div className=\"VVBody\">  \r\n        {/* <Link  to={\"/Myvote\"} ><div>返回</div></Link> */}\r\n        <h1>{vote.title}</h1>\r\n        <h2>{vote.desc}{vote.multiSelect?\"[多选]\":\"[单选]\"}</h2>\r\n        \r\n        {optionsInfo.map((option,idx)=>{\r\n          var selected = option.Users.some(user=>{\r\n            return  userInfo&&user.id == userInfo.id\r\n            })\r\n          return (\r\n            <div className=\"warp\" key={idx}>\r\n              <div className=\"optionsWrap\" onClick={()=>voteOption(option.id,selected)}>\r\n                <span>{option.content}</span>\r\n                <span className=\"checkWrap\">{selected?\r\n                  <span className=\"checked\">\r\n                    <CheckOutlined className=\"CheckOutlined\" style={{color:\"rgb(37,109,242)\",fontSize:20}} />\r\n                    <Spin className=\"spin\" indicator={antIcon} style={{color:\"rgba(0,0,0,0)\"}} />\r\n                  </span>\r\n                  :\"\"}\r\n                </span>\r\n                <span>({option.Users.length}票)</span>\r\n                <span>({(option.Users.length /((allUsers.length*100)==0?1:(allUsers.length))*100).toFixed(2)}%)</span>\r\n                <Progress percent={(option.Users.length /((allUsers.length*100)==0?1:(allUsers.length))*100).toFixed(2)} \r\n                strokeLinecap=\"square\"  showInfo={false} trailColor=\"rgba(0,0,0,0)\" strokeColor=\"rgb(37,109,242)\" strokeWidth=\"0.02rem\"/>\r\n              </div>\r\n              {\r\n                !vote.anonymous&&userInfo.avatar&&\r\n                <div>\r\n                  {option.Users.map((user,idx)=>{\r\n                    return <img src={user.avatar} key={idx} style={{display:\"inline-block\",width:\"0.3rem\",height:\"0.3rem\",borderRadius:\"30rem\",textAlign:\"center\",verticalAlign:\"center\"}} />\r\n                    \r\n                  })}\r\n                </div>\r\n              }\r\n          \r\n            </div>\r\n          )\r\n        })\r\n        }\r\n        <div className=\"time\">{\"投票截止:\"+(vote.deadline).slice(0,10).concat(\" \"+ (vote.deadline).slice(11,16))}</div>\r\n      </div>\r\n      )  \r\n  }//bug 实时投票如何做   \r\n","import axios from \"axios\";\r\nimport { useEffect, useState} from \"react\";\r\n// import { useUserInfo } from \"./UserContext\";\r\nimport {Link} from \"react-router-dom\"\r\n\r\nimport { useSelector } from \"react-redux\"\r\n\r\nimport {List,InfiniteLoader} from \"react-virtualized\"\r\n\r\n\r\nimport \"./Myvote.css\"\r\nimport \"react-virtualized/styles.css\"\r\n\r\n//antd\r\n\r\n\r\n\r\nexport default function My(){\r\n\r\n  const userInfo = useSelector(state=> state.user)  \r\n  \r\n  // var userInfo = useUserInfo()\r\n  var [voteData,setVoteData] = useState({rows:[],count:6})          //bug 会发生最好一个不加载 \r\n  var [votes,setVotes] = useState([])                               //bug 当vote为null初始值 会导致不更新\r\n  var [counts,setCounts] = useState(null)\r\n\r\n  // var idRef = useRef()\r\n  // useEffect(()=>{ \r\n  //   axios.get('/vote/myVotes?page='+page).then(res=>{\r\n  //     setVoteData(res.data.rows)\r\n  //     setVotes(res.data.votes)\r\n  //     setPage(page=>page + 1)\r\n  //   })                                            //bug useEffect 会不停调用\r\n  // },[userInfo])\r\n\r\n  useEffect(()=>{\r\n    axios.get(\"/vote/voteUser\").then(res=>{\r\n      setCounts(res.data)\r\n    })\r\n    \r\n  },[userInfo])\r\n  \r\n\r\n  \r\n      \r\n  // function countVoter(UserVoteId){\r\n    \r\n  //   var count = new Set()                          //bug 为解决  查出所有数据 垃圾做法\r\n  //   if(counts){\r\n  //     for(var vote of counts){\r\n  //       if(vote.voteId==UserVoteId){\r\n  //         count.add(vote.UserId)\r\n  //       }\r\n  //     }\r\n  //   }\r\n  //   setCountV(count.size)\r\n  //   // return count.size  \r\n  // }\r\n  // console.log(idRef)\r\n  // useMemo(()=>{(async ()=>{ if(idRef) countVoter(votes[idRef.current].id)})()},[votes])\r\n  \r\n  if(!votes){\r\n    return (\r\n      <div>\r\n        loading... \r\n      </div>\r\n    )\r\n  }\r\n  \r\n  function loadMore({startIndex,stopIndex}){                                                       // bug  loadMore 需要返回promise对象\r\n  \r\n    return  axios.get(`/vote/myVotes?startIndex=${startIndex}&stopIndex=${stopIndex+1}`).then(res=>{\r\n      setVoteData(res.data)                   //里面有总条目数\r\n      votes.splice(startIndex,0,...res.data.rows)\r\n      setVotes([...votes])\r\n    }).catch(e=>{\r\n      console.log(e)\r\n    })                \r\n  } \r\n\r\n  function rowRenderer({key,index,style}){\r\n\r\n    function countVoter(UserVoteId){\r\n      var count = new Set()                          //bug 为解决  查出所有数据 垃圾做法\r\n      if(counts){\r\n        for(var vote of counts){\r\n          if(vote.voteId==UserVoteId){\r\n            count.add(vote.UserId)\r\n          }\r\n        }\r\n      }\r\n      // setCountV(count.size)\r\n      return count.size  \r\n    }\r\n   \r\n    if(index >= votes.length){\r\n      return <div style={style} key={key}>loading...</div>\r\n    }\r\n     let countV = countVoter(votes[index].id)\r\n    return (\r\n    <div style={style} key={key}  >\r\n      <Link  to={\"/vote/\"+votes[index].id} className=\"wrap\"><div>{votes[index].title}</div><div>{countV}</div></Link>\r\n    </div>)\r\n  }\r\n\r\n  \r\n  function isRowLoaded({ index }) {\r\n    return !!votes[index]\r\n  }\r\n\r\n  return (\r\n    <div>\r\n    <InfiniteLoader\r\n        isRowLoaded={isRowLoaded}                    //bug 没用触发请求votes\r\n        loadMoreRows={loadMore}                 //加载更多页\r\n        rowCount={voteData.count}               //列计数       \r\n      >\r\n        {({onRowsRendered, registerChild}) => (\r\n          <List\r\n            onRowsRendered={onRowsRendered}\r\n            ref={registerChild}\r\n            width={window.outerWidth}                         //宽度\r\n            height={window.outerHeight}                        //高度\r\n            rowCount={voteData.count}           \r\n            rowHeight={100}\r\n            rowRenderer={rowRenderer}\r\n          />\r\n        )}\r\n      </InfiniteLoader>\r\n      </div>\r\n    // <div>\r\n    //   <ul className=\"lists\">\r\n    //     {votes.rows.map((vote,idx)=>{\r\n    //       return <li  key = {idx}> \r\n    //       <Link to={\"/vote/ \" +vote.id}>\r\n    //         <div className=\"wrap\">\r\n    //           <span >{vote.title}</span>\r\n    //           <span>{countVoter(vote.id)}</span>\r\n    //         </div>\r\n    //       </Link></li>  \r\n    //     })}\r\n    //   </ul>\r\n    // </div>\r\n  )\r\n}\r\n//bug   /vote/ 不加/会发生vote%201\r\n","import { NavLink as Link, Switch, Route, useHistory, Redirect, } from \"react-router-dom\"\nimport { Suspense, useEffect } from \"react\"\nimport Login from \"./Login\"\nimport Register from \"./Register\"\nimport Home from \"./Home\"\n// import UserContext from \"./UserContext\"        //传参\n\nimport CreateVote from \"./CreateVote\"\nimport ViewVote from \"./ViewVote\"\nimport './App.css';\n\nimport My from \"./Myvote\"\n\nimport { useSelector, useDispatch, } from \"react-redux\"\n\n\n//antd\nimport { Layout, Button } from 'antd';\nconst { Content } = Layout;\n\n\n\n\nfunction App() {\n  const history = useHistory()\n  // const [userInfo,setUserInfo] = useState(null)\n  \n  \n\n  const userInfo = useSelector(state => state.user)       //redux \n  const dispatch = useDispatch()\n\n  async function logout() {\n    dispatch({ type: \"logout\" })\n    history.push(\"/login\")\n  }\n\n  // (async () =>{\n  //   if(!userInfo){\n  //     try{\n  //       var info = (await axios.get('/account/userinfo')).data        \n  //       setUserInfo(info)           //获取info\n  //     }catch (e){\n  //       console.log(\"用户未登录\")\n  //     }\n  //   }\n  // })() \n  //},[userInfo])\n  useEffect(() => {\n    dispatch({ type: \"get-user-info\" })      //redux \n  }, [])\n  \n\n\n  return (\n    // 传递信息\n    // <UserContext.Provider value={{userInfo:userInfo}}>  \n    <div className=\"App\" >\n      <Switch>\n        <Route path=\"/\" exact>\n          <Redirect to=\"/home\"></Redirect>\n        </Route>\n        <Route path=\"/login\" component={Login} />\n        <Route path=\"/register\" component={Register} />\n        <Route path=\"/home\" component={Home} />\n        <Route path=\"/create\" component={CreateVote} />\n        <Route path=\"/Myvote\" component={My} />\n        <Route path=\"/vote/:id\">\n          <Suspense fallback={'loading'}>\n            <ViewVote />\n          </Suspense>\n        </Route>\n      </Switch>\n\n      <Content className=\"footer\" >\n        {userInfo\n          ? <>\n            <div className=\"foot\" >\n              <img src={userInfo.avatar} className=\"avatar\" alt=\"头像\" />\n              <Button size={\"small\"} className=\"logout\" onClick={logout}>登出</Button>\n            </div>\n            <div className=\"linkWap\" >\n              <Link to=\"/home\" className=\"home\"  alt=\"home\" >  <img src=\"./icons/newicon.png\" /> <img src=\"./icons/newgrey.png\" /><br />新建</Link>\n              <Link to=\"/Myvote\" className=\"Myvote\"  alt=\"Myvote\" ><img src=\"./icons/myicon.png\" /><img src=\"./icons/mygrey.png\" />  <br />我的</Link>\n            </div>\n          </>\n          : <>\n            <div className=\"linkWap\" >\n              <Link to=\"/login\" className=\"login\">登录</Link>\n              <Link to=\"/register\" className=\"register\">注册</Link>\n            </div>\n          </>\n        }\n      </Content>\n    </div>\n    // </UserContext.Provider>\n  );\n}\n\nexport default App;\n//bug component 里 {My}是函数名  path 是文件名\n","import axios from \"axios\"\r\nimport {applyMiddleware, createStore} from \"redux\"\r\nimport createSagaMiddleware from \"redux-saga\"\r\nimport {put,takeEvery} from \"redux-saga/effects\"\r\n\r\n\r\n\r\nconst saga = createSagaMiddleware()\r\n\r\nconst initialState = {\r\n  user:null,\r\n  vote:{},\r\n  triedLogin: false,//尝试登陆但没成功时为真\r\n}\r\n\r\n\r\nconst store = createStore((state=initialState ,action)=>{            //bug state不传init值会读不到数据\r\n  switch(action.type){\r\n    case \"user-info\" :\r\n      return {\r\n        ...state,\r\n        user:action.user\r\n      }\r\n    case \"remove-user-info\":\r\n      return {\r\n        ...state,\r\n        user:null           \r\n      }\r\n    case 'try-login-failed':\r\n      return {\r\n        ...state,\r\n        triedLogin: true\r\n      }\r\n    default:\r\n      return state\r\n  }\r\n},applyMiddleware(saga))\r\n\r\n\r\nexport default store                                  //export 时候不能命名\r\n\r\nfunction* getUserInfo(action){\r\n  try{\r\n    var res = yield axios.get('/account/userinfo')\r\n    yield put({type:\"user-info\",user:res.data})\r\n  }catch(e){\r\n    yield put({type: 'try-login-failed'})                //bug  不能throw e 只能使用put \r\n  }\r\n  \r\n}\r\n\r\n\r\n\r\nfunction* login(action){\r\n  try{\r\n    var res = yield axios.post(\"/account/login\",{\r\n      name:action.name,\r\n      password:action.password,\r\n    })\r\n    yield put({type:\"user-info\",user:res.data})\r\n  } catch(e) {\r\n    throw e\r\n  }                                                            //bug 不能抛错\r\n}\r\n\r\nfunction* logout(action){\r\n  var res = yield axios.get(\"/account/logout\")\r\n  yield put({type:\"remove-user-info\"})\r\n}\r\n\r\nfunction* rootSaga(){\r\n  yield takeEvery('get-user-info',getUserInfo)\r\n  yield takeEvery('login',login)\r\n  yield takeEvery('logout',logout)\r\n}\r\nsaga.run(rootSaga)\r\n","import React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport App from './App';\nimport {HashRouter as Router} from　\"react-router-dom\"\n\nimport store from \"./store\"\nimport { Provider } from \"react-redux\"              //1.redux \n\nimport 'antd/dist/antd.css'; // or 'antd/dist/antd.less'\nimport \"./index.css\"\nimport { ConfigProvider } from 'antd';\n\nimport zhCN from 'antd/lib/locale/zh_CN';\nimport moment from 'moment';\nimport 'moment/locale/zh-cn';\nmoment.locale('zh-cn');\ndocument.documentElement.style.fontSize = window.innerWidth / 375 * 100 + 'px'\n\nwindow.onresize = () => {\n  document.documentElement.style.fontSize = window.innerWidth / 375 * 100 + 'px'\n}\n\nReactDOM.render(\n  \n  <React.StrictMode>\n    \n    <ConfigProvider locale={zhCN}>\n    <Router>\n      <Provider store={store}>\n        <App />\n      </Provider>\n    </Router>\n    </ConfigProvider>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}